image: docker:19.03.0

variables:
    DOCKER_DRIVER: overlay2
    DOCKER_TLS_CERTDIR: "/certs"

services:
    - docker:19.03.0-dind

stages:
    - build
    # - tag

build:
    stage: build
    tags:
        - docker
    script:
        - apk update && apk add bash git
        - bash run_static_analysis.sh
        - bash scripts/build.sh
    except:
        - /-backup$/
        - /-wip$/

# tag:
#     stage: tag
#     tags:
#         - linux
#     script:
#         - apk update && apk add bash git
#         - bash scripts/tag.sh
#     only:
#         - /^master$/
